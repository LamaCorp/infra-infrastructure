---

systemd_networkd_netdev:
  tinc-lama:
    - NetDev:
        - Name: tinc-lama
        - Kind: tap
        - MTUBytes: 1405

systemd_networkd_network:
  tinc-lama:
    - Match:
        - Name: tinc-lama
    - Link:
        - MTUBytes: 1405
    - Network:
        - DHCP: "no"
        - Address: "{{ tinc_network_lama_internal_addr4 }}"
        - Address: "{{ tinc_network_lama_internal_addr6 }}"

tinc_networks_lama_hosts: |
  {% for host in groups['vpn'] %}
  {{ host }}:
    conf:
      Name: {{ hostvars[host].tinc_networks.lama.main.Name }}
      Address: {{ hostvars[host].tinc_network_lama_address | default(None) }}
      ClampMSS: "no"
  {% endfor %}


tinc_networks:
  lama:
    main:
      Name: "{{ (inventory_hostname | split('.'))[0:2] | reverse | join('_') | regex_replace('[^0-9a-zA-Z]+', '_') }}"
      BindToInterface: "{{ tinc_network_lama_bind_to_interface }}"
      Interface: tinc-lama
      LocalDiscovery: "yes"
      Mode: switch
    hosts: "{{ tinc_networks_lama_hosts | from_yaml }}"
