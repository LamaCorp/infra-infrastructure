# yaml-language-server: $schema=https://goauthentik.io/blueprints/schema.json
# yamllint disable
---
version: 1
metadata:
  name: Outposts
entries:
  - model: authentik_blueprints.metaapplyblueprint
    attrs:
      identifiers:
        name: Apps - ArchiveBox
      required: true
  - model: authentik_blueprints.metaapplyblueprint
    attrs:
      identifiers:
        name: Apps - k3s.fsn.as212024.net observability
      required: true
  - model: authentik_blueprints.metaapplyblueprint
    attrs:
      identifiers:
        name: Apps - Thanos
      required: true
  - model: authentik_blueprints.metaapplyblueprint
    attrs:
      identifiers:
        name: Apps - V-Core 3
      required: true

  - model: authentik_outposts.outpost
    identifiers:
      managed: goauthentik.io/outposts/embedded
    attrs:
      service_connection:
        !Find [
          authentik_outposts.outpostserviceconnection,
          [name, "Local Kubernetes Cluster"],
        ]
      providers:
        - !Find [
            authentik_core.provider,
            [name, "k8s/k3s.fsn.as212024.net/services-archivebox"],
          ]
        - !Find [authentik_core.provider, [name, "v-core-3"]]
      config:
        log_level: info
        authentik_host: https://auth.lama-corp.space
        kubernetes_ingress_annotations:
          cert-manager.io/cluster-issuer: letsencrypt-prod-http01
        object_naming_template: ak-outpost-%(name)s
        kubernetes_ingress_secret_name: authentik-outpost-tls
        kubernetes_disabled_components:
          - deployment
          - secret

  - model: authentik_outposts.outpost
    identifiers:
      name: "Proxy Outpost as212024.net"
    attrs:
      type: proxy
      service_connection:
        !Find [
          authentik_outposts.outpostserviceconnection,
          [name, "Local Kubernetes Cluster"],
        ]
      providers:
        - !Find [
            authentik_core.provider,
            [name, "k8s/k3s.fsn.as212024/infra-observability/thanos-bucketweb"],
          ]
        - !Find [
            authentik_core.provider,
            [name, "k8s/k3s.fsn.as212024.net/core-observability/alertmanager"],
          ]
      config:
        log_level: info
        authentik_host: https://auth.as212024.net
        kubernetes_ingress_annotations:
          cert-manager.io/cluster-issuer: letsencrypt-prod-http01
        kubernetes_ingress_secret_name: authentik-outpost-as212024-net-tls

  - model: authentik_outposts.outpost
    identifiers:
      name: "LDAP Outpost"
    attrs:
      type: ldap
      service_connection:
        !Find [
          authentik_outposts.outpostserviceconnection,
          [name, "Local Kubernetes Cluster"],
        ]
      providers:
        - !Find [
            authentik_core.provider,
            [name, "k8s/k3s.fsn.as212024.net/services-stalwart/ldap"],
          ]
      config:
        log_level: info
        authentik_host: https://auth.lama-corp.space
